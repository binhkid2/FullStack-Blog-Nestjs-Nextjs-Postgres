<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>{{ title or "Duc Binh Blog" }}</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;700&family=Source+Serif+4:wght@400;600;700&display=swap" rel="stylesheet" />
  <script src="https://unpkg.com/htmx.org@1.9.12"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
</head>
<body class="min-h-screen bg-gradient-to-b from-amber-50 via-stone-50 to-emerald-50 font-[Space_Grotesk] text-zinc-900 antialiased">
  <div class="mx-auto w-full max-w-7xl px-4 pb-10 pt-4 sm:px-6 lg:px-8">
    <header class="sticky top-3 z-20 mb-4 rounded-2xl border border-zinc-200/80 bg-white/90 shadow-sm backdrop-blur">
      <div class="flex flex-wrap items-center justify-between gap-3 px-4 py-3">
        <a class="inline-flex items-center gap-2 text-zinc-900 no-underline transition hover:text-teal-700" href="/">
          <span class="inline-flex h-8 w-8 items-center justify-center rounded-full bg-teal-600 text-xs font-bold text-white">DB</span>
          <span class="text-base font-semibold">Duc Binh Blog</span>
        </a>

        <nav class="flex flex-wrap items-center gap-2 text-sm">
          <a class="rounded-full border border-zinc-200 bg-white px-3 py-1.5 font-medium text-zinc-700 no-underline transition hover:border-teal-500 hover:text-teal-700" href="/">Home</a>
          {% if currentUser %}
          <a class="rounded-full border border-zinc-200 bg-white px-3 py-1.5 font-medium text-zinc-700 no-underline transition hover:border-teal-500 hover:text-teal-700" href="/dashboard">Dashboard</a>
          <form hx-post="/auth/logout" hx-target="#flash" hx-swap="innerHTML" class="m-0">
            <button class="rounded-full border border-rose-200 bg-white px-3 py-1.5 text-sm font-medium text-rose-700 transition hover:bg-rose-50" type="submit">Logout</button>
          </form>
          {% else %}
          <a class="rounded-full border border-zinc-200 bg-white px-3 py-1.5 font-medium text-zinc-700 no-underline transition hover:border-teal-500 hover:text-teal-700" href="/auth">Auth</a>
          {% endif %}
        </nav>
      </div>
    </header>

    <main class="space-y-4">
      {% block body %}{% endblock %}
    </main>
  </div>

  <div id="flash" class="pointer-events-none fixed right-4 top-4 z-50 flex w-[min(26rem,calc(100%-2rem))] flex-col gap-2">
    {% include "partials/flash.njk" %}
  </div>

  <script>
    function readCookie(name) {
      const cookie = document.cookie
        .split(";")
        .map((entry) => entry.trim())
        .find((entry) => entry.startsWith(name + "="));
      return cookie ? decodeURIComponent(cookie.split("=").slice(1).join("=")) : "";
    }

    document.body.addEventListener("htmx:configRequest", function(event) {
      const csrfToken = readCookie("csrfToken");
      if (csrfToken) {
        event.detail.headers["x-csrf-token"] = csrfToken;
      }
    });

    window.refreshDashboardPosts = function() {
      if (document.querySelector("#dashboard-posts-table")) {
        htmx.ajax("GET", "/blog-posts/partials/table", {
          target: "#dashboard-posts-table",
          swap: "innerHTML"
        });
      }
    };

    window.refreshDashboardUsers = function() {
      if (document.querySelector("#dashboard-users-table")) {
        htmx.ajax("GET", "/users/partials/table?page=1&pageSize=50", {
          target: "#dashboard-users-table",
          swap: "innerHTML"
        });
      }
    };
  </script>
</body>
</html>
